import { useEffect, useRef } from "react";
import { gsap } from "gsap";
import Lenis from "@studio-freight/lenis";

import { ScrollTrigger } from "gsap/ScrollTrigger";

export default function NavBar({ sectionRefs }) {
  const navBar = useRef(null);
  const logo = useRef(null);
  const cta = useRef(null);
  const tl = gsap.timeline();
  gsap.registerPlugin(ScrollTrigger);

  useEffect(() => {
    const lenis = new Lenis();
    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);
  });

  useEffect(() => {
    tl.to(navBar.current, {
      y: 0,
      duration: 3,
      delay: 0.5,
      ease: "power4.inOut",
    });
  });


  useEffect(() => {
    sectionRefs.forEach((section) => {
      ScrollTrigger.create({
        trigger: section,
        start: "top 375px",
        end: "bottom 300px",
        // markers: true,
        animation: gsap
          .timeline()
          .to(navBar.current, { color: "#DDDDD5" })
          .to(cta.current, { backgroundColor: "#D1D1C7", color: "#0E0E0C" }, 0)
          .to(".bg-secondary-100", { backgroundColor: "#0E0E0C" }, 0),

        toggleActions: "restart reverse restart reverse",
      });
    });

  });

  return (
    <header
      ref={navBar}
      className="fixed top-0 z-50 flex w-full -translate-y-full items-center justify-between bg-secondary-100 px-5 py-3"
    >
      {/* logo */}
      <a href="#hero" aria-label="Logo" className="z-50">
        <svg
          ref={logo}
          width="80"
          height="45"
          viewBox="0 0 287.061 104.981"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path d="M 167.578 92.285 L 150.293 92.285 L 150.293 6.348 L 167.578 6.348 L 167.578 44.287 L 175.977 19.043 L 194.092 19.043 L 183.106 50.879 L 197.07 92.285 L 178.467 92.285 L 167.578 57.764 L 167.578 92.285 Z M 117.92 92.285 L 100.44 92.285 L 100.44 19.043 L 117.92 19.043 L 117.92 28.369 A 16.669 16.669 0 0 1 119.799 23.606 A 14.989 14.989 0 0 1 121.558 21.216 A 8.72 8.72 0 0 1 126.585 18.47 A 12.853 12.853 0 0 1 128.955 18.262 A 19.504 19.504 0 0 1 133.11 18.675 Q 135.703 19.241 137.605 20.581 A 10.416 10.416 0 0 1 140.015 22.949 A 16.274 16.274 0 0 1 142.486 28.105 Q 143.457 31.459 143.457 35.791 L 143.457 92.285 L 126.221 92.285 L 126.221 37.598 A 9.183 9.183 0 0 0 125.595 34.198 A 8.798 8.798 0 0 0 125.342 33.618 Q 124.463 31.787 122.315 31.787 Q 120.313 31.787 119.361 33.179 Q 118.408 34.57 118.164 36.646 Q 117.92 38.721 117.92 40.771 L 117.92 92.285 Z M 217.676 104.492 L 197.949 104.492 L 197.949 93.408 L 206.348 93.408 Q 208.2 93.408 208.251 92.161 A 1.752 1.752 0 0 0 208.252 92.09 A 7.007 7.007 0 0 0 208.163 90.992 A 8.052 8.052 0 0 0 208.106 90.674 L 196.631 19.043 L 213.379 19.043 L 218.262 72.949 L 224.024 19.043 L 240.869 19.043 L 227.295 96.094 A 17.188 17.188 0 0 1 226.651 98.654 Q 226.209 99.95 225.58 100.963 A 8.168 8.168 0 0 1 224.487 102.368 A 6.119 6.119 0 0 1 222.275 103.777 Q 221.293 104.156 220.059 104.334 A 16.739 16.739 0 0 1 217.676 104.492 Z M 14.649 48.682 L 25.488 44.971 L 25.488 37.451 A 13.549 13.549 0 0 0 25.353 35.443 Q 24.969 32.893 23.495 32.01 A 3.561 3.561 0 0 0 21.631 31.543 A 3.606 3.606 0 0 0 19.981 31.896 Q 18.115 32.842 18.115 36.328 L 18.115 40.723 L 1.123 40.723 Q 1.09 40.46 1.08 40.099 A 12.703 12.703 0 0 1 1.074 39.722 L 1.074 38.33 Q 1.074 27.393 6.226 22.827 Q 11.181 18.436 21.716 18.268 A 53.106 53.106 0 0 1 22.559 18.262 A 28.37 28.37 0 0 1 28.44 18.847 A 22.853 22.853 0 0 1 33.057 20.337 A 16.964 16.964 0 0 1 40.405 26.465 A 15.642 15.642 0 0 1 42.702 32.111 A 21.912 21.912 0 0 1 43.115 36.475 L 43.115 92.285 L 25.733 92.285 L 25.733 83.594 A 17.226 17.226 0 0 1 24.487 86.852 Q 23.319 89.137 21.533 90.625 Q 18.604 93.066 14.844 93.066 Q 8.74 93.066 5.542 90.234 A 13.299 13.299 0 0 1 2.161 85.485 A 18.089 18.089 0 0 1 1.172 82.471 A 41.459 41.459 0 0 1 0.293 77.209 Q 0.009 74.501 0 71.484 A 66.361 66.361 0 0 1 0 71.289 A 56.079 56.079 0 0 1 0.156 66.976 Q 0.319 64.873 0.651 63.082 A 24.544 24.544 0 0 1 1.319 60.327 A 15.195 15.195 0 0 1 3.939 55.28 A 14.303 14.303 0 0 1 5.835 53.32 A 19.611 19.611 0 0 1 8.833 51.236 Q 10.384 50.346 12.268 49.571 A 40.122 40.122 0 0 1 14.649 48.682 Z M 258.594 48.682 L 269.434 44.971 L 269.434 37.451 A 13.549 13.549 0 0 0 269.298 35.443 Q 268.914 32.893 267.441 32.01 A 3.561 3.561 0 0 0 265.576 31.543 A 3.606 3.606 0 0 0 263.927 31.896 Q 262.061 32.842 262.061 36.328 L 262.061 40.723 L 245.069 40.723 Q 245.036 40.46 245.025 40.099 A 12.703 12.703 0 0 1 245.02 39.722 L 245.02 38.33 Q 245.02 27.393 250.171 22.827 Q 255.126 18.436 265.661 18.268 A 53.106 53.106 0 0 1 266.504 18.262 A 28.37 28.37 0 0 1 272.385 18.847 A 22.853 22.853 0 0 1 277.002 20.337 A 16.964 16.964 0 0 1 284.351 26.465 A 15.642 15.642 0 0 1 286.647 32.111 A 21.912 21.912 0 0 1 287.061 36.475 L 287.061 92.285 L 269.678 92.285 L 269.678 83.594 A 17.226 17.226 0 0 1 268.433 86.852 Q 267.264 89.137 265.479 90.625 Q 262.549 93.066 258.789 93.066 Q 252.686 93.066 249.487 90.234 A 13.299 13.299 0 0 1 246.106 85.485 A 18.089 18.089 0 0 1 245.117 82.471 A 41.459 41.459 0 0 1 244.238 77.209 Q 243.955 74.501 243.946 71.484 A 66.361 66.361 0 0 1 243.945 71.289 A 56.079 56.079 0 0 1 244.101 66.976 Q 244.264 64.873 244.596 63.082 A 24.544 24.544 0 0 1 245.264 60.327 A 15.195 15.195 0 0 1 247.884 55.28 A 14.303 14.303 0 0 1 249.78 53.32 A 19.611 19.611 0 0 1 252.778 51.236 Q 254.329 50.346 256.213 49.571 A 40.122 40.122 0 0 1 258.594 48.682 Z M 47.998 103.711 L 47.998 91.992 Q 48.848 92.228 49.561 92.236 A 4.438 4.438 0 0 0 49.61 92.236 A 3.116 3.116 0 0 0 50.232 92.179 Q 50.575 92.109 50.823 91.953 A 1.298 1.298 0 0 0 51.367 91.26 A 5.373 5.373 0 0 0 51.582 90.415 Q 51.658 89.986 51.688 89.486 A 11.728 11.728 0 0 0 51.709 88.77 L 51.709 19.043 L 69.19 19.043 L 69.19 88.281 Q 69.19 96.094 66.089 100.537 Q 63.412 104.373 57.406 104.897 A 22.847 22.847 0 0 1 55.42 104.98 Q 49.951 104.98 48.064 103.755 A 3.306 3.306 0 0 1 47.998 103.711 Z M 93.506 92.285 L 76.026 92.285 L 76.026 19.043 L 93.506 19.043 L 93.506 92.285 Z M 69.19 14.551 L 51.709 14.551 L 51.709 0 L 69.19 0 L 69.19 14.551 Z M 93.506 14.551 L 76.026 14.551 L 76.026 0 L 93.506 0 L 93.506 14.551 Z M 25.44 73.779 L 25.44 53.369 Q 21.826 54.834 19.824 57.056 Q 18.221 58.835 17.902 61.945 A 15.967 15.967 0 0 0 17.822 63.574 L 17.822 72.998 A 16.144 16.144 0 0 0 17.96 75.205 Q 18.555 79.492 21.729 79.492 A 3.918 3.918 0 0 0 22.884 79.333 Q 24.08 78.965 24.632 77.745 A 3.876 3.876 0 0 0 24.658 77.686 A 9.661 9.661 0 0 0 25.436 74.057 A 11.132 11.132 0 0 0 25.44 73.779 Z M 269.385 73.779 L 269.385 53.369 Q 265.772 54.834 263.77 57.056 Q 262.167 58.835 261.847 61.945 A 15.967 15.967 0 0 0 261.768 63.574 L 261.768 72.998 A 16.144 16.144 0 0 0 261.905 75.205 Q 262.5 79.492 265.674 79.492 A 3.918 3.918 0 0 0 266.829 79.333 Q 268.026 78.965 268.578 77.745 A 3.876 3.876 0 0 0 268.604 77.686 A 9.661 9.661 0 0 0 269.381 74.057 A 11.132 11.132 0 0 0 269.385 73.779 Z"/>
          
        </svg>
      </a>
      <nav className=" space-x-7 font-grotesk text-body-3 sm:block">
        <a href="#about" className="group relative hidden md:inline-block">
          <span>about</span>
          <span className="absolute bottom-0 left-0 h-[0.125em] w-0 rounded-full bg-secondary-600 duration-300 ease-in-out group-hover:w-full"></span>
        </a>
        <a href="#services" className="group relative hidden md:inline-block">
          <span>services</span>
          <span className="absolute bottom-0 left-0 h-[0.125em] w-0 rounded-full bg-secondary-600 duration-300 ease-in-out group-hover:w-full"></span>
        </a>
        <a href="#works" className="group relative hidden md:inline-block">
          <span>projects</span>
          <span className="absolute bottom-0 left-0 h-[0.125em] w-0 rounded-full bg-secondary-600 duration-300 ease-in-out group-hover:w-full"></span>
        </a>
        <a
          ref={cta}
          className="button group relative hover:bg-transparent"
          href="#contact"
        >
          <span className="relative w-fit">
            <span className="absolute bottom-2 h-[0.15em] w-0 bg-secondary-700 opacity-90 duration-300 ease-out group-hover:w-full"></span>
            <span>Let&apos;s Talk.</span>
          </span>
        </a>
      </nav>
    </header>
  );
}
